A<!DOCTYPE html>
<head>
  <title>davo roe</title>
  <link href="stylesheets/vrugan.css" rel="stylesheet">   
  <meta name="viewport" content="minimum-scale=1">  
  <meta name="viewport" content="maximum-scale=1">  
</head>
<body>
  <div class="body-bground">
    <img class="body-bground-img" src="/bground/assets/poly-settings.png">
  </div>
  <div class="container">
    <main>
      <div class="stage-view paper-only">
	<div class="stage-surface paper-only">
	  <div class="paper"><div class="text">davo roe</div></div>
	</div>
      </div>
      <div class="stage-view">
	<div class="stage-surface">
	  <div class="paper penta">
	    <div class="penta-string">
  	     <div class="side s-1">
	     </div>
	     <div class="side s-2">
	     </div>
	     <div class="side s-3">
	     </div>
	     <div class="side s-4">
	     </div>
	     <div class="side s-5">
	     </div>
	    </div>
	  </div>
	</div>
	</div>
    </main>
  </div>
  <script type="module" src="/js/util/util.js"></script>
  <script type="module">

    import { util, tr, offsetter, postfixer } from '../../js/globals.js'
    import { qs } from '../../../js/util/util.js'
    import { vrug } from '../../js/vrug.js'
    import explodePenta from '../../js/explodePenta.js'

    const ranges = offsetter()
    const vhStartPoint = postfixer(ranges.startPoint, 'vh')
    const vhEndPoint = postfixer(ranges.endPoint, 'vh')

    const addVh = (str, num) => {
	return `${num + parseInt(str, 10) }vh`
    }

    const master = vrug('body')
 
    const follower = master
	  .scrolls('.stage-view.paper-only')

    const initPentaWidth = (n) => {
	const initAmt =  util('5vw').toPx()
	const amt =  Math.max( initAmt, 15  );
	return amt;
    }

    const scrollOnscreen = vhStartPoint(50)
    const scrollOnscreenEnd = vhEndPoint(125)

    const scrollOffscreen = addVh(scrollOnscreenEnd, 1200)
    const scrollOffscreenEnd = addVh(scrollOffscreen, 200)
   
    const astScrollStart = addVh(scrollOnscreenEnd, 0)
    const astScrollEnd = addVh(astScrollStart, 175)

    const startSpread = addVh(astScrollEnd, 300)
    const endSpread = addVh(startSpread, 150)

    const rotateOneStart = astScrollEnd
    const rotateOneEnd = addVh(endSpread, 200)

    const explodeStart = rotateOneEnd
    const explodeEnd = addVh(rotateOneEnd, 350)
    
    // Coming onstage
    follower    
     .senses('v')
     .responds('v')
     .set('start', '0vh')
     .set('end', '100vh')
     .set('parentStart', scrollOnscreen)
     .set('parentEnd', scrollOnscreenEnd)
     .listen()

    // scrolling off
    follower
     .senses('v')
     .responds('v')
     .set('start', '100vh')
     .set('end', '200vh')
     .set('parentStart', scrollOffscreen)
     .set('parentEnd', scrollOffscreenEnd )
     .listen()

    const follower4pre = master
	  .scrolls('.stage-view:not(.paper-only)')
 
    // asterisk scrolls onscreen
    follower4pre
     .senses('v')
     .responds('v')
     .set('start', '0vh')
     .set('end', '100vh')
    // match the first one
    .set('parentStart',  astScrollStart)
    // match the first one
    .set('parentEnd', astScrollEnd)
    .listen()

    // asterisk spreads
    const pentas = document.querySelectorAll('.side')

    follower4pre
    .senses('v')
    // match the first one
    .set('parentStart',  addVh(startSpread, 0))
    // match the first one
    .set('parentEnd', addVh(endSpread, 0))
    .listen((pos, obj) => {
	return explodePenta(pentas, pos, obj, 0, initPentaWidth()  )
    })

    const follower4 = master
	  .scrolls('.penta-string')
    
    const pentaState = {}
    const penta = qs('.penta')

    const updatePentaDom = (el, deg, colorOpac) => {
      el.style.transform =`rotateZ(${deg}deg)`
    }

    const spinHelper = (pos, ps, pe) => {
	const tot = pe - ps
	const prog = tr((pos - pe) / tot * 1000) / 1000
	const modPos1 =  pos % ( 360 * 150)
	const multiplier = tr(modPos1 / (360* 10) * 360 * 100 ) /100
	return multiplier
    }

    const rotatePenta = (pos, obj) => {
	
	const el = obj.el

	const rawPs = obj.get('parentStart')
	const rawPe = obj.get('parentEnd')

	const ps = obj.get('pixels', 'ps')
	const pe = obj.get('pixels', 'pe')
	let spinParams
	  
	if (pos < ps) {
	    spinParams = spinHelper(ps, ps, pe)
	} else if (pos > pe) {
	    spinParams = spinHelper(pe, ps, pe)
	} else {
	    spinParams = spinHelper(pos, ps, pe)
	}
	  
	// rotate only
	updatePentaDom(el, spinParams)	    
    }

    
    // Pentagon rotation only
    follower4
      .senses('v')
      .set('parentStart', rotateOneStart  )
      .set('parentEnd', rotateOneEnd )
      .listen(rotatePenta)



    follower4
    .senses('v')
    // flies apart
    .set('parentStart', explodeStart )    
    .set('parentEnd', explodeEnd  )
    .listen((pos, obj) => {

	if (pos < obj.get('pixels','ps' ) ) {
	    return
	}

        return explodePenta(pentas, pos, obj, initPentaWidth() , 900) 
    })
   
    follower.init()
    follower4pre.init()
    follower4.init()

  </script>
</body>
